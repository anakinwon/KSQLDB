# KSQLDB Usecase 실전 실습

### KSQLDB와 Elasticsearch 연동 및 Kibana 시각화 실전 실습

- order 주문과 매출액 관련 분석 Table을 연동하는 Elasticsearch sink connector 생성. 
- es_sink_order_metric.json 으로 저장.

```sql
{
    "name": "es_sink_order_metric",
    "config": {
        "connector.class": "io.confluent.connect.elasticsearch.ElasticsearchSinkConnector",
        "tasks.max": "1",
        "topics": "order_cnt_by_state, order_metric_by_brand, grade_cnt",
        "connection.url": "http://192.168.56.101:9200",
        "connection.username": "es_connect_dev",
        "connection.password": "es_connect_dev",

        "key.ignore": "false",
        "schema.ignore": "false",

        "key.converter": "io.confluent.connect.avro.AvroConverter",
        "value.converter": "io.confluent.connect.avro.AvroConverter",
        "key.converter.schema.registry.url": "http://localhost:8081",
        "value.converter.schema.registry.url": "http://localhost:8081"

    }
}
```



- 30분 주기 order 주문과 매출액 관련 분석 Table을 연동하는 Elasticsearch sink connector 생성. 
- es_sink_order_metric_per_mins.json 으로 저장.

```sql
{
    "name": "es_sink_order_metric_per_mins",
    "config": {
        "connector.class": "io.confluent.connect.elasticsearch.ElasticsearchSinkConnector",
        "tasks.max": "1",
        "topics": "order_metric_by_state_per_30mins, order_metric_per_30mins",

        "connection.url": "http://192.168.56.101:9200",
        "connection.username": "es_connect_dev",
        "connection.password": "es_connect_dev",

        "key.ignore": "false",
        "schema.ignore": "false",

        "key.converter": "io.confluent.connect.avro.AvroConverter",
        "value.converter": "io.confluent.connect.avro.AvroConverter",
        "key.converter.schema.registry.url": "http://localhost:8081",
        "value.converter.schema.registry.url": "http://localhost:8081",

        "transforms": "create_key, extract_key",
        "transforms.create_key.type": "org.apache.kafka.connect.transforms.ValueToKey",
        "transforms.create_key.fields": "DOC_ID",
        "transforms.extract_key.type": "org.apache.kafka.connect.transforms.ExtractField$Key",
        "transforms.extract_key.field": "DOC_ID"
    }
}
```
